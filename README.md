# R-SSH
![GitHub Workflow Status](https://img.shields.io/github/workflow/status/pagran/r-ssh/Lint%20and%20test)
![Docker Cloud Build Status](https://img.shields.io/docker/cloud/build/pagran/r-ssh)
![Docker Image Version (latest semver)](https://img.shields.io/docker/v/pagran/r-ssh)
[![Go Report Card](https://goreportcard.com/badge/github.com/pagran/r-ssh)](https://goreportcard.com/report/github.com/pagran/r-ssh)
![GitHub go.mod Go version (subfolder of monorepo)](https://img.shields.io/github/go-mod/go-version/pagran/r-ssh)
![Uptime Robot status](https://img.shields.io/uptimerobot/status/m785561650-f777533a7adf78012658518f?label=public%20server)
![GitHub](https://img.shields.io/github/license/pagran/r-ssh)

## What can the program do?
This program allows you to quickly and safely forward local port without configuring the infrastructure.

Features:
1. Unique static subdomain based on public key fingerprint (md5).
2. Standard ssh clients are supported.
3. Supported http and https forwarding.
4. Automatic header correction for Host, Origin.
5. Supports X-Forwarded-For, X-Forwarded-Host, X-Forwarded-Proto.

## What does it take to work?

1. SSH client.
2. Public key (for authorization).
3. Running **r-ssh** server

## How to use?

### Syntax


```sh
ssh -R [domain[+flags]:]<port>:target_domain:target_port <host>
```

**domain** - The domain to which requests will be redirected (`Host` and `Origin` headers will be replaced by this value if the corresponding flag is enabled) _[optional]_.

**flags** - Flags change the logic of port forwarding. _[optional]_

Available flags:
1. **s** - redirect https
2. **o** - automatically fix `Origin` header (see **domain**)

**port** - Optional for **r-ssh**, but mandatory for ssh client. Affects only the link generated by r-ssh. By default, port 80 is not included in the link.

**target_domain** - Server to which requests will be redirected
**target_port** - The port to which requests will be redirected


#### Examples

Forward local http://localhost:8080/ to web

```sh
ssh -R 80:localhost:8080 <host>

# forward "localhost:80" to "https://<fingeprint>.<host>/"
```

Forward https://example.com:443/ to web with automatic `Host` correction

```sh
ssh -R example.com+s:80:example.com:443 <host>

# forward "example.com+s:80" to "https://example_com-<fingeprint>.<host>/"
```


#### End-to-end example
[![asciicast](https://asciinema.org/a/Ykmxb0lOEX0m9YNIXWT3j1SDe.svg)](https://asciinema.org/a/Ykmxb0lOEX0m9YNIXWT3j1SDe)


# Self-hosted

### Docker

Without ssl:
```sh
docker run -d --restart always --name rssh -p 22:22 -p 80:80 -e RSSH_HOST=<host> -e RSSH_HOST_KEY=/mnt/id_rsa -v /root/r-ssh/:/mnt pagran/r-ssh:latest
```

With ssl (wildcard certificate required):

```sh
docker run -d --restart always --name rssh -p 22:22 -p 80:80 -p 443:443 -e RSSH_HOST=<host> -e RSSH_HOST_KEY=/mnt/id_rsa -e RSSH_CERT_FILE=/mnt/<host>.cer -e RSSH_KEY_FILE=/mnt/<host>.key -v /root/.acme.sh/<host>/:/mnt pagran/r-ssh:latest
```
